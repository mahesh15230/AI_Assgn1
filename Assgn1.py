import numpy as np                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               #YMC98 #YMC98
import math                                                                                                                                                                                                                                                                                                                                                                                                                                                   #YMC98     #YMC98
import matplotlib.pyplot as plt                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98                   #YMC98
#import pdb                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #YMC98   #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98    #YMC98               #YMC98
#Holder table                                                                                                                                                                                                                                                                                                                                                                                                                                             #YMC98           #YMC98
pop_size = 15                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98                  #YMC98
gens = 30                                                                                                                                                                                                                                                                                                                                                                                                                                                  #YMC98      #YMC98
cross_prob = .8                                                                                                                                                                                                                                                                                                                                                                                                                                                    #YMC98    #YMC98
K = .5                                                                                                                                                                                                                                                                                                                                                                                                                                                 #YMC98       #YMC98
F = 0                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
limitsHolder = [-10,10]                                                                                                                                                                                                                                                                                                                                                                                                                                                  #YMC98      #YMC98
limitsEgg = [-1,1]                                                                                                                                                                                                                                                                                                                                                                                                                                                #YMC98        #YMC98
delta = 100                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98#YMC98
bestsol = []                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
def criteria_check(sol,mode="Holder"):                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
    if mode!="Holder":                                                                                                                                                                                                                                                                                                                                                                                                                                                   #YMC98     #YMC98
        return limitsEgg[0] <= sol[0] <= limitsEgg[1] and limitsEgg[0] <= sol[1] <= limitsEgg[1]                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98    #YMC98
    else:                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
        return limitsHolder[0] <= sol[0] <= limitsHolder[1] and limitsHolder[0] <= sol[1] <= limitsHolder[1]                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
def fitfunc(sol, mode="Egg", objfnmode=None):#Egg,None for egg holder                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
    if objfnmode == None:                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
        if mode=="Egg":                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
            return math.sqrt((sol[0]-1)**2+(sol[1]-0.7895154296875)**2)                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
        else:                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
            return math.sqrt((sol[0]-8.05502)**2 + (sol[1]-9.66549)**2)                                                                                                                                                                                                                                                                                                                                                                                                                                                  #YMC98      #YMC98
    else:                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
        if mode == None:                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
            return -(512*sol[1]+47)*math.sin(math.sqrt(np.abs((sol[0]*256)+sol[1]*512+47)))-sol[0]*512*math.sin(math.sqrt(np.abs(sol[0]*512-sol[1]*512-47)))                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
        else:                                                                                                                                                                                                                                                                                                                                                                                                                                                   #YMC98     #YMC98
            return -np.abs(*math.sin(sol[0])*math.cos(sol[1])*np.exp(np.abs(1-(math.sqrt(sol[0]**2+sol[1]**2)/math.pi))))                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
def iscross():                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
    return np.random.uniform(0,1) < cross_prob                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
#Initialize population                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98 #YMC98
def gencandidate(mode):                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
    if mode=='Holder':                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
        candidates = [list(np.random.uniform(-10,10,2)) for i in range(pop_size)]                                                                                                                                                                                                                                                                                                                                                                                                                                                    #YMC98    #YMC98
    else:                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
        candidates = [np.random.uniform(-1,1,2) for i in range(pop_size)]                                                                                                                                                                                                                                                                                                                                                                                                                                                      #YMC98  #YMC98
    return candidates                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                                #YMC98                                            #YMC98                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98                                                                                                                                                                                                                            #YMC98                                                                                                                                                                                                                            #YMC98                                                                                                                                                                                                                            #YMC98
candidates = gencandidate('Holder')                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98 #YMC98
#pdb.set_trace()                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98 #YMC98

for j in range(gens):                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98 #YMC98
    print('gens')                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98#YMC98                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
    F = np.random.uniform(-2,2) # Same F value for the current gen                                                                                                                                                                                                                                                                                                                                                                                                                   #YMC98                                                                                                                                                                                                                                                                                                                                   #YMC98  #YMC98
    print('Traversing all candidates')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                #YMC98#YMC98          
    for i in range(pop_size):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
        check = False                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
        temp = []                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98        #YMC98
        while not check:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98   #YMC98
            #Mutation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
            print("Mutation")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #YMC98       #YMC98
            xr1 = candidates[np.random.randint(0,pop_size)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #YMC98   #YMC98
            xr2 = candidates[np.random.randint(0,pop_size)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
            xr3 = candidates[np.random.randint(0,pop_size)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #YMC98       #YMC98
            temp = candidates[i]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98           #YMC98
            candidates[i][0] += K*(xr1[0] - candidates[i][0]) + F*(xr2[0] - xr3[0])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #YMC98   #YMC98
            candidates[i][1] += K*(xr1[1] - candidates[i][1]) + F*(xr2[1] - xr3[1])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    #YMC98            #YMC98
            #CrossOver                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
            if iscross():                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
                index1 = int(np.random.uniform(0,2))%2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
                if not index1:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #YMC98      #YMC98
                    (candidates[i][0],temp[0]) = (temp[0],candidates[i][0])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
                    (candidates[i][1],temp[1]) = (temp[1],candidates[i][1])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
                else:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     #YMC98     #YMC98                                                                                                                                                                                                                                                                                      #YMC98                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
                    (candidates[i][1],temp[1]) = (temp[1],candidates[i][1])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #YMC98      #YMC98
            print("CrossOver")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
            #Check Criteria                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
            check = criteria_check(candidates[i],'Holder')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               #YMC98 #YMC98
            print('check is ',check)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             #YMC98   #YMC98
            print('temp : ',temp)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
            print('candidates : ',candidates[i])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              #YMC98  #YMC98
            #print("Check Criteria")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
        #Perform Selection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
        if fitfunc(temp,'Holder') < fitfunc(candidates[i],'Holder'):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
            candidates[i] = temp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         #YMC98       #YMC98
        print('selection')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            #YMC98    #YMC98
        print('delta value ',delta)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #YMC98      #YMC98
        if delta > fitfunc(candidates[i],'Holder'):                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #YMC98      #YMC98
            delta = fitfunc(candidates[i],'Holder')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98         #YMC98
        bestsol.append(delta)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98     #YMC98
        print('Solution is : ',candidates[i])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #YMC98      #YMC98
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          #YMC98      #YMC98
plt.plot(bestsol)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98        #YMC98
plt.ylabel("Best solution generation-wise")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        #YMC98        #YMC98
print('whew')                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       #YMC98         #YMC98
print("last best sol is ",delta)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           #YMC98                     #YMC98
